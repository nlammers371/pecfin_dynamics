import os
import zarr
import napari
import numpy as np


root = "E:\\Nick\Cole Trapnell's Lab Dropbox\\Nick Lammers\\Nick\pecfin_dynamics\\fin_morphodynamics\\"
scale_vec = np.asarray([2.0, 0.55, 0.55])
experiment_date = "20240223"
model_name = "log-v5"

# make directory paths
label_directory = os.path.join(root, "built_data", "cellpose_output", model_name, experiment_date, '')
data_directory = os.path.join(root, "built_data", "zarr_image_files", experiment_date, '')
cellpose_directory = os.path.join(root, "built_data", "cellpose_output", model_name, experiment_date, '')

#########
# load the original labels, probs, and grads generated by CellPose
time_int = 101
well_int = 0
file_prefix = experiment_date + f"_well{well_int:04}"
prob_name = os.path.join(cellpose_directory, file_prefix + "_probs.zarr")
grad_name = os.path.join(cellpose_directory, file_prefix + "_grads.zarr")
mask_name = os.path.join(cellpose_directory, file_prefix + "_labels.zarr")

mask_zarr = zarr.open(mask_name, mode="r")
prob_zarr = zarr.open(prob_name, mode="r")
grad_zarr = zarr.open(grad_name, mode="r")

# load the raw image data
data_tzyx = zarr.open(os.path.join(data_directory, file_prefix + ".zarr"), mode="r")

# subset top the desired time point
data_zyx = data_tzyx[time_int, :, :, :]

# use affinity graph method from omnipose core to stitch masks at different probability levels





